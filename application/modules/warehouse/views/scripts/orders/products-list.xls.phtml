<?php

require_once $_SERVER['DOCUMENT_ROOT'] . '/../library/PHPExcel/PHPExcel.php';

$filename = !empty($vars['filepath']) ? $_SERVER['DOCUMENT_ROOT'] . $vars['filepath'] : '';
$filename .= !empty($vars['filename']) ? $vars['filename'] : 'document.xlsx';

$objPHPExcel = new PHPExcel();
$objPHPExcel->setActiveSheetIndex(0);

$rowNo = 1;
$objPHPExcel->getActiveSheet()->SetCellValue('A' . $rowNo, 'Magazyn');
$objPHPExcel->getActiveSheet()->SetCellValue('B' . $rowNo, 'Technik');
$objPHPExcel->getActiveSheet()->SetCellValue('C' . $rowNo, 'Nazwa');
$objPHPExcel->getActiveSheet()->SetCellValue('D' . $rowNo, 'Numer seryjny');
$objPHPExcel->getActiveSheet()->SetCellValue('E' . $rowNo, 'Ilość wydana');
$objPHPExcel->getActiveSheet()->SetCellValue('F' . $rowNo, 'Data wydania');
$objPHPExcel->getActiveSheet()->SetCellValue('G' . $rowNo, 'Klient');
$rowNo = 2;
foreach ($vars['products'] as $product) {//var_dump($product);exit;
    $objPHPExcel->getActiveSheet()->SetCellValue('A' . $rowNo, $product->warehouse);
    $objPHPExcel->getActiveSheet()->SetCellValue('B' . $rowNo, $product->technician);
    $objPHPExcel->getActiveSheet()->SetCellValue('C' . $rowNo, $product->product);
    $objPHPExcel->getActiveSheet()->SetCellValue('D' . $rowNo, $product->serial);
    $objPHPExcel->getActiveSheet()->SetCellValue('E' . $rowNo, $product->quantity);
    $objPHPExcel->getActiveSheet()->SetCellValue('F' . $rowNo, $product->releasedate);
    $objPHPExcel->getActiveSheet()->SetCellValue('G' . $rowNo, $product->client);
    $rowNo++;
}

//$objWriter = new PHPExcel_Writer_Excel2007($objPHPExcel);
$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
//$objWriter->save('php://output');
$objWriter->save($filename);
//$result = $_SERVER['DOCUMENT_ROOT'] . '/some_excel_file.xlsx';
//header('Content-Description: File Transfer');
//header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
//header('Content-Disposition: attachment; filename=' . ($vars['filename'] ? $vars['filename'] : 'document.xlsx'));

?>